<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ğŸŒŠ ç®¡è·¯ç›£æ¸¬ç³»çµ± Pro</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; color: #333; }
        .container { max-width: 500px; margin: auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .card { background: #f8f9fa; border-radius: 10px; padding: 15px; margin-bottom: 20px; border-left: 5px solid #1a73e8; }
        .val-big { font-size: 32px; font-weight: bold; color: #1a73e8; }
        .diagnosis { padding: 15px; border-radius: 10px; font-weight: bold; text-align: center; }
        .param-text { font-size: 13px; color: #666; line-height: 1.6; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align:center;">ğŸŒŠ ç®¡è·¯ç›£æ¸¬ç³»çµ± Pro</h2>
    <p id="status" style="text-align:center; font-size:12px; color:red;">â— é›²ç«¯é€£ç·šä¸­...</p>

    <div class="card">
        <div style="display:flex; justify-content:space-around; text-align:center;">
            <div>
                <div style="font-size:12px;">å³æ™‚æ°´ä½</div>
                <span class="val-big" id="w-val">--</span><span style="font-size:14px;"> cm</span>
            </div>
            <div>
                <div style="font-size:12px;">ç†è«–æµé€Ÿ (V)</div>
                <span class="val-big" id="f-val">--</span><span style="font-size:14px;"> m/s</span>
            </div>
        </div>
    </div>

    <div class="card">
        <strong>âš™ï¸ æ›¼å¯§å…¬å¼åƒæ•¸è¨­å®š</strong>
        <div class="param-text">
            ç²—ç³™ä¿‚æ•¸ (n): 0.03<br>
            ç®¡è·¯åŠå¾‘ (r): 20 cm<br>
            è¨­è¨ˆå¡åº¦ (S): 0.001<br>
            å…¬å¼: V = (1/n) * R^(2/3) * S^(1/2)
        </div>
    </div>

    <div id="diag-box" class="diagnosis" style="background:#eee;">ç­‰å¾…æ•¸æ“šä¸­...</div>
</div>

<script>
    const client = mqtt.connect('ws://broker.hivemq.com:8000/mqtt');
    const topic = 'yechenyin3032/water_data';

    client.on('connect', () => {
        client.subscribe(topic);
        const status = document.getElementById("status");
        status.innerText = "â— é›²ç«¯é€£ç·šæ­£å¸¸ (ä¸é™ç¶²åŸŸ)";
        status.style.color = "green";
    });

    client.on('message', (t, msg) => {
        const data = JSON.parse(msg.toString());
        document.getElementById("w-val").innerText = data.level;
        document.getElementById("f-val").innerText = data.flow;
        
        const box = document.getElementById("diag-box");
        box.innerText = data.msg;

        if(data.msg.includes("âœ…")) {
            box.style.background = "#f6ffed"; box.style.color = "#389e0d";
        } else {
            box.style.background = "#fff1f0"; box.style.color = "#cf1322";
        }
    });
</script>
</body>
</html>
