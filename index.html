<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒŠ ç®¡è·¯ç›£æ¸¬ç³»çµ± Pro</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <style>
        body { font-family: sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 90%; max-width: 500px; text-align: center; }
        h1 { color: #1a73e8; margin-bottom: 5px; }
        #status-tag { display: inline-block; padding: 5px 15px; border-radius: 20px; font-size: 14px; background: #fff1f0; color: #cf1322; margin-bottom: 20px; }
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .card { background: #f8f9fa; padding: 20px; border-radius: 15px; border-top: 4px solid #1a73e8; }
        .val { font-size: 32px; font-weight: bold; display: block; margin: 10px 0; }
        .diagnosis { background: #e8f0fe; padding: 15px; border-radius: 10px; font-weight: bold; color: #1967d2; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸŒŠ ç®¡è·¯ç›£æ¸¬ç³»çµ± Pro</h1>
    <div id="status-tag">â— é›²ç«¯å˜—è©¦é€£ç·šä¸­...</div>

    <div class="data-grid">
        <div class="card">
            <span style="color: #5f6368;">ç›®å‰æ°´ä½</span>
            <span id="w-val" class="val">--</span>
            <span style="color: #5f6368;">cm</span>
        </div>
        <div class="card">
            <span style="color: #5f6368;">é ä¼°æµé€Ÿ</span>
            <span class="val">0.00</span>
            <span style="color: #5f6368;">m/s</span>
        </div>
    </div>

    <div class="diagnosis">
        ç³»çµ±è¨ºæ–·çµæœï¼š<span id="d-msg">ç­‰å¾…æ•¸æ“šä¸­...</span>
    </div>
</div>

<script>
    const client = mqtt.connect('ws://broker.hivemq.com:8000/mqtt');
    const myTopic = "yechenyin3032/water_data";

    client.on('connect', () => {
        client.subscribe(myTopic);
        const tag = document.getElementById("status-tag");
        tag.innerText = "â— é›²ç«¯å³æ™‚é€£ç·šä¸­";
        tag.style.background = "#f6ffed";
        tag.style.color = "#389e0d";
    });

    client.on('message', (topic, message) => {
        const data = JSON.parse(message.toString());
        document.getElementById("w-val").innerText = data.level;
        document.getElementById("d-msg").innerText = data.msg;
        
        // å¦‚æœæ°´ä½é«˜æ–¼ 26.6cm (1/3 é«˜) è®Šè‰²æé†’
        document.getElementById("d-msg").style.color = (parseFloat(data.level) >= 26.6) ? "#d93025" : "#1967d2";
    });
</script>

</body>
</html>
